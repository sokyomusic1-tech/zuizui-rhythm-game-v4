# Project TODO

## Phase 1: プロジェクト初期化
- [x] プロジェクトの初期化
- [x] 音声ファイルの確認
- [x] design.mdの作成

## Phase 2: コア機能実装
- [x] 音声ファイルをプロジェクトに配置
- [x] オーディオ再生機能の実装
- [x] ノーツレーンとタップエリアのUI実装
- [x] ノーツ生成ロジックの実装
- [x] タップ判定システムの実装
- [x] スコアリングシステムの実装
- [x] コンボシステムの実装

## Phase 3: 難易度レベルとノーツデータ
- [x] Easy難易度のノーツデータ作成
- [x] Normal難易度のノーツデータ作成
- [x] Hard難易度のノーツデータ作成
- [x] 難易度選択画面の実装

## Phase 4: UI/UX改善
- [x] ホーム画面の実装
- [x] リザルト画面の実装
- [x] ハイスコア保存機能（AsyncStorage）
- [x] 和風テーマのカラーパレット適用
- [x] タップ時のハプティクスフィードバック
- [x] ビジュアルエフェクト（判定表示、コンボ表示）

## Phase 5: テストとデバッグ
- [x] タップ判定精度のテスト
- [x] スコア計算のテスト
- [x] 音声同期のテスト
- [x] 各難易度のバランス調整

## Phase 6: 最終調整
- [x] アプリロゴの生成と設定
- [x] アプリ名の設定
- [x] 最終チェックポイントの作成

## Phase 7: ロゴとGoogle AdSense広告の追加
- [x] 新しいロゴ画像をアプリアイコンとして設定
- [x] ロゴURLをapp.config.tsに更新
- [x] Google AdSense広告コンポーネントの作成
- [x] リザルト画面に広告を配置
- [x] ホーム画面に広告を配置（オプション）
- [x] 広告の動作確認
- [x] 最終チェックポイントの作成

## Phase 8: 実際の音楽ファイルの追加
- [x] 元のWAVファイルをMP3に変換（192kbps、ファイルサイズ削減）
- [x] MP3ファイルをプロジェクトに配置
- [ ] 音声再生の動作確認
- [ ] 最終チェックポイントの作成

## Phase 9: スコア判定とAdSense表示の問題修正
- [x] スコア判定システムのデバッグ（Perfect/Good/Missが0のまま）
- [x] タップイベントハンドラーの確認
- [x] ゲームロジックの修正
- [x] リザルト画面の色修正（白背景に白文字問題）
- [ ] AdSense広告が表示されない問題の調査
- [ ] AdSenseスクリプトの読み込み確認
- [ ] 広告表示の修正
- [ ] 動作確認とテスト
- [ ] 最終チェックポイントの作成

## Phase 10: BPM分析とリズム修正
- [x] 音声ファイルのBPM分析（BPM 164）
- [x] BPMに合わせたノーツデータの再生成
- [x] 各難易度のノーツ配置調整
- [x] リズム同期のテスト

## Phase 11: UI最終調整
- [x] ホーム画面にロゴ画像を追加
- [x] ホーム画面のハイスコア色修正
- [x] リザルト画面の色修正
- [x] 難易度選択画面の色修正
- [ ] 最終チェックポイントの作成

## Phase 12: ユーザー名入力・保存機能
- [x] ユーザー名入力画面の作成
- [x] AsyncStorageでユーザー名を保存
- [x] 初回起動時にユーザー名入力を促す
- [x] ユーザー名変更機能（設定画面）

## Phase 13: 全国ランキング機能
- [x] データベーススキーマの設計（scores テーブル）
- [x] APIエンドポイントの実装（スコア送信、ランキング取得）
- [x] ランキング画面の作成
- [x] スコア送信機能の実装（リザルト画面から）
- [x] ランキング表示機能（トップ100）
- [x] 難易度別ランキング表示

## Phase 14: UI/UX改善（ランキング関連）
- [x] ホーム画面にランキングボタンを追加
- [x] リザルト画面にスコア送信確認ダイアログを追加
- [x] ランキング画面のデザイン（順位、ユーザー名、スコア、日付）

## Phase 15: テストとチェックポイント
- [x] ユーザー名入力のバリデーション
- [x] スコア送信のエラーハンドリング
- [x] ランキング取得のエラーハンドリング
- [x] オフライン時の動作確認
- [x] 最終チェックポイントの作成

## Phase 16: AdSense配置の最適化
- [x] ホーム画面の広告を下部に移動（スクロール領域内）
- [x] リザルト画面の広告を下部に移動（スコア表示の邪魔にならない位置）
- [x] ランキング画面の広告配置（リスト下部）
- [x] ゲーム画面には広告を表示しない（ゲームプレイの邪魔にならないように）

## Phase 17: 2曲目の追加
- [x] 音楽ファイル（WAV）をプロジェクトに配置
- [x] カバー画像をプロジェクトに配置
- [x] 2曲目の曲データを作成（BPM 76）
- [x] 1曲目のタイトルを更新（「ズイズイソング 和風ロック」）
- [x] 曲選択画面のUI実装（横スクロール）
- [x] ナビゲーションを更新（ホーム → 曲選択 → 難易度選択 → ゲーム）
- [x] 曲選択画面のデザイン（カバー画像、タイトル、BPM表示）
- [x] テストとチェックポイント作成

## Phase 18: バグ修正
- [x] ノーツがチカチカする問題を修正（レンダリング最適化）
- [x] 1曲目の画像が中央揃えになっていない問題を修正
- [x] テストとチェックポイント作成

## Phase 19: 3曲目の追加
- [x] 3曲目「モエチャッカファイア (Cover) Metal x EDM」を追加（BPM 81.6）
- [x] 3曲目のカバー画像を生成
- [x] 3曲目の音楽ファイルをプロジェクトに追加
- [x] 曲選択画面に3曲目を表示
- [x] テストとチェックポイント作成

## Phase 20: スマホでのゲームプレイ問題修正
- [x] ノーツのチカチカ（点滅）を修正
- [x] タップ判定前にノーツが消える問題を修正
- [x] タップが効かない問題を修正
- [x] 判定を4段階（Perfect / Good / Normal / Miss）に変更
- [x] 判定範囲を緩くする
- [x] ゲーム中に「戻る」を押しても曲が再生され続ける問題を修正
- [x] テストとチェックポイント作成

## Phase 21: タップが全てMissになる問題修正
- [x] タップ判定ロジックのバグを特定
- [x] タップ判定を修正
- [x] テストとチェックポイント作成

## Phase 22: タップエフェクトの追加とタップ機能修正
- [x] タップ時にレーンにエフェクトを追加
- [x] タップ判定ロジックを再検討
- [x] テストとチェックポイント作成
- [x] ブラウザを閉じても音楽が再生され続ける問題を修正

## Phase 23: 判定エリアのタップ対応とPerfectエフェクト
- [x] 判定エリア（〇）をタップ可能にする
- [x] Perfect時に特別なエフェクトを追加
- [x] テストとチェックポイント作成
- [x] リザルト画面の「MENU」ボタンの下にAdSenseを追加（既に実装済み）

## Phase 24: 判定エリアのデザイン修正
- [x] 判定エリアのデザインを元に戻す
- [x] テストとチェックポイント作成

## Phase 25: Perfect時の爆発エフェクト
- [x] 爆発エフェクト画像をプロジェクトに追加
- [x] Perfectエフェクトを爆発画像に変更
- [x] テストとチェックポイント作成

## Phase 26: 曲終了後のノーツ問題とPerfectエフェクト修正
- [x] 曲が終わってもノーツが落ち続ける問題を修正
- [x] Perfectエフェクトをタップしたノーツの位置で爆裂するように変更
- [x] テストとチェックポイント作成

## Phase 27: 曲終了時の自動リザルト遷移機能
- [x] 曲終了検知ロジックの実装（音楽再生終了イベント）
- [x] リザルト画面への自動遷移機能
- [x] ノーツ生成停止ロジックの修正
- [x] テストとチェックポイント作成

## Phase 28: 曲の進行状況プログレスバー
- [x] プログレスバーのUIデザイン（画面上部に配置）
- [x] プログレスバーの実装（gameTimeとsongDurationを使用）
- [x] テストとチェックポイント作成

## Phase 29: 曲の長さ表示とノーツ生成時間の調整
- [x] 曲データに長さ（duration）を追加（３：２７、３：４９、３：５３）
- [x] 曲選択画面に曲の長さを表示
- [x] 難易度選択画面に曲の長さを表示
- [x] ノーツ生成ロジックを曲の長さに合わせて調整
- [x] テストとチェックポイント作成

## Phase 30: リザルト画面のAdSense修正とランキング送信エラー修正
- [x] ランキング送信エラーの原因を調査
- [x] ランキング送信機能を修正
- [x] リザルト画面に指定されたAdSenseコードを完璧に実装
- [x] テストとチェックポイント作成

## Phase 31: 曲選択画面のAdSense追加
- [x] 曲選択画面にAdSenseコードを追加
- [x] テストとチェックポイント作成

## Phase 32: 曲選択画面の画像表示問題修正
- [x] 画像が表示されない原因を調査
- [x] 画像表示の問題を修正
- [x] テストとチェックポイント作成

## Phase 33: 曲選択画面のAdSense削除と画像表示問題の根本解決
- [x] 曲選択画面のAdSenseを削除
- [x] 画像表示問題を根本的に調査・修正（S3 URLに変更）
- [x] テストとチェックポイント作成

## Phase 34: 1曲目の画像サイズを2、3曲目と同じにする
- [x] 1曲目の横長画像を生成（元の画像を切り抜き）
- [x] 画像をS3にアップロードしてURLを更新
- [x] テストとチェックポイント作成

## Phase 35: ランキング送信エラー修正とタップ効果音追加
- [x] ランキング送信エラーの原因を調査（Failed to fetch）
- [x] Netlifyプロキシ設定ファイルを作成
- [x] APIサーバーURLを設定（Renderにデプロイ）
- [x] タップ時の効果音を追加
- [ ] テストとチェックポイント作成

## Phase 36: ランキング送信「Failed to fetch」エラーの修正
- [x] エラー原因の調査（ネットワーク、CORS、API接続）
- [x] API接続設定の確認と修正
- [x] Webビルドの再実行
- [x] デプロイとテスト
- [x] チェックポイント作成

## Phase 37: オフラインモード機能の実装
- [x] オフラインスコア保存機能の設計
- [x] ローカルストレージにスコアを保存する機能を実装
- [x] 自動送信機能を実装（アプリ起動時、ホーム画面表示時）
- [x] UIにオフラインスコア数の表示を追加
- [x] Webビルドとデプロイ
- [x] チェックポイント作成

## Phase 38: ランキング画面のデータ取得修正
- [x] ランキング画面の現状確認
- [x] サーバーからランキングデータを取得する処理を修正
- [x] エラーハンドリングとローディング表示を改善
- [x] Webビルドとデプロイ
- [x] チェックポイント作成

## Phase 39: 2曲目のバグ修正（ノーツが落ち続ける、メーター表示異常）
- [x] 2曲目のバグ確認（楽曲データ、ノーツ生成処理）
- [x] ノーツ生成と楽曲終了処理の修正
- [x] メーター表示の修正
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 40: プロジェクトセカイ風の音ゲー進化計画

### 優先度A（ゲームプレイの核心）
- [x] 判定精度の向上（Fast/Lateの表示）
- [x] ノーツスピード調整機能
- [ ] ロングノーツ（長押し）の実装
- [ ] フリックノーツ（スワイプ）の実装
- [ ] スライドノーツ（レーン移動）の実装

### 優先度B（ビジュアル・演出）
- [ ] コンボ数の大きな表示
- [ ] 背景画像の表示
- [ ] ノーツエフェクトの強化
- [ ] フルコンボ/オールパーフェクト演出

## Phase 42: 優先度A・B機能の実装（第1弾）
- [x] コンボ表示の強化
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## 次回実装予定（優先度A・B）
- [ ] ロングノーツ（長押し）の実装
- [ ] フリックノーツ（スワイプ）の実装
- [ ] 背景画像の表示
- [ ] ノーツエフェクトの強化
- [ ] フルコンボ/オールパーフェクト演出
- [ ] スライドノーツ（レーン移動）の実装

### 優先度C（プレイヤー体験）
- [ ] リザルト画面の詳細化（Fast/Late統計）
- [ ] リプレイ機能
- [ ] オートプレイ機能
- [ ] 練習モード（スピード調整、区間リピート）
- [ ] タイミング調整（オフセット設定）

### 優先度D（ソーシャル機能）
- [ ] フレンド機能
- [ ] マルチプレイ（協力/対戦）
- [ ] ギルド/チーム機能
- [ ] イベントランキング

### 優先度E（コンテンツ拡張）
- [ ] キャラクターシステム
- [ ] ガチャ/カード収集
- [ ] ストーリーモード
- [ ] 楽曲アンロックシステム

## Phase 41: 2曲目の楽曲長さとノーツ生成の修正
- [x] 2曲目の楽曲データ（duration）を確認
- [x] ノーツ生成ロジックを修正（曲の長さ以上のノーツを生成しない）
- [x] 楽曲終了処理を修正（曲が終わったらすぐにリザルト画面へ）
- [x] プログレスバーの長さを修正
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 43: 優先度A・B機能の実装（第2弾）
- [x] 背景画像の表示
- [x] ノーツエフェクトの強化
- [x] フルコンボ/オールパーフェクト演出
- [x] Webビルドとデプロイ
- [x] チェックポイント作成（スキップ、ZIPファイルで直接デプロイ）

## Phase 44: プログレスバーと時間表示の修正
- [x] プログレスバーの長さを曲の実際の長さに合わせる
- [x] バーの下に経過時間/曲の長さを表示
- [ ] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 45: 2曲目の音楽ファイル更新
- [x] 2曲目の音楽ファイルを正しいバージョンに更新
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 46: 優先度A・B機能の実装（第2弾 - ロングノーツ）
- [x] ノーツタイプに `long` を追加
- [x] `duration`（長さ）プロパティを追加
- [x] ロングノーツの視覚的表現を実装（縦長のノーツ）
- [x] タッチイベント処理（押し続ける判定）
- [x] スコアリング（途中で離すとMiss）
- [x] ロングノーツを譜面データに追加
- [ ] テストとチェックポイント作成

## Phase 47: 優先度A・B機能の実装（第2弾 - フリックノーツ）
- [ ] ノーツタイプに `flick` を追加
- [ ] `direction`（方向）プロパティを追加（上/下/左/右）
- [ ] ジェスチャー認識（スワイプ方向の判定）
- [ ] 視覚的なフィードバック（矢印表示）
- [ ] フリックノーツを譜面データに追加
- [ ] テストとチェックポイント作成

## Phase 48: 優先度A・B機能の実装（第2弾 - スライドノーツ）
- [ ] ノーツタイプに `slide` を追加
- [ ] `path`（経路）プロパティを追加
- [ ] 連続タッチ判定（指を離さずに移動）
- [ ] 視覚的なフィードバック（スライド経路の表示）
- [ ] スライドノーツを譜面データに追加
- [ ] テストとチェックポイント作成

## Phase 49: 2曲目を130秒（2分10秒）に設定
- [x] 2曲目の音楽ファイルの長さを再確認
- [x] song-data.tsの長さを130秒に変更
- [ ] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 50: Hard難易度でロングノーツが生成されない問題の修正
- [x] ロングノーツ生成ロジックを確認
- [x] ロングノーツの生成確率を上げる（10% → 30%）
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 51: フリックノーツ（スワイプ）機能の実装
- [x] FlickDirection型を追加
- [x] フリックノーツの視覚的表現を実装（青色 + 矢印）
- [x] スワイプジェスチャー認識を実装
- [x] フリックノーツを譜面データに追加（Hard難易度で20%）
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 52: 全難易度でロングノーツとフリックノーツを出現させる
- [x] Easy: ロングノーツ10%、フリックノーツ10%
- [x] Normal: ロングノーツ20%、フリックノーツ15%
- [x] Hard: ロングノーツ30%、フリックノーツ20%（現状維持）
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 53: プロセカ風の機能追加（第3弾）

### ランキングシステムの改善
- [x] データベーススキーマを設計（songIdカラムを追加）
- [x] ランキングAPIを実装（getBySong, getTopScoresBySong）
- [x] 曲別ランキング画面を作成（song-ranking.tsx）
- [x] 曲選択画面からランキングへのリンクを追加
- [x] Webビルドとデプロイ

### ノーツの視覚改善
- [x] ノーツにグラデーション効果を追加
- [x] ノーツの光るエフェクトを追加
- [x] タップエフェクトを強化
- [x] 判定ラインを光らせる

### フィーバーモード
- [x] フィーバーモードの状態管理を追加
- [x] 50コンボで発動する仕組みを実装
- [x] スコア倍率1.5倍を実装
- [x] フィーバー中の視覚効果を追加
- [x] フィーバーゲージのUI表示

### 完了
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 54: 連続ノーッのタップ判定バグ修正
- [x] タップ判定ロジックを確認
- [x] ノーツの処理済みフラグを修正（ロング・フリックノーツもactiveNotesから削除）
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 55: ロングノーツを押し続けている時にMISSと表示される問題の修正
- [x] ロングノーツのMISS判定ロジックを確認
- [x] ロングノーツの判定を修正（holdingNotesにある場合はMISS判定をスキップ）
- [x] Webビルドとデプロイ
- [ ] チェックポイント作成

## Phase 56: ロングノーツの複数の問題を修正
- [ ] ロングノーツの終点マーカーを追加（視覚的改善）
- [ ] ロングノーツ開始時にクリックするとノーツが消える問題を修正
- [ ] 同じレーンが続くとタップが効かない問題を修正
- [ ] Webビルドとデプロイ
- [ ] チェックポイント作成
